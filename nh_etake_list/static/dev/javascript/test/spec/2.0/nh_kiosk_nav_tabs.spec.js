var leftbarFixture = '<div class="oe_leftbar nh_kiosk_nav nh_eobs_show">'
                   + '<div groups="base.group_user,base.group_portal">'
                   + '<a class="oe_logo" href="/web">'
                   + '<span class="oe_logo_edit">Edit Company data</span>'
                   + '<img src="http://localhost:8169/web/binary/company_logo?company=1">'
                   + '</a>'
                   + '<div>'
                   + '<div>'
                   + '<div class="oe_secondary_menus_container">'
                   + '<div style="display: none;" class="oe_secondary_menu" data-menu-parent="145">'
                   + '<div class="oe_secondary_menu_section">Patient Management</div>'
                   + '<ul class="oe_secondary_submenu nav nav-pills nav-stacked">'
                   + '<li class="">'
                   + '<a href="/web#menu_id=147&amp;action=148" class="oe_menu_leaf" data-menu="147" data-action-model="ir.actions.act_window" data-action-id="148">'
                   + '<span class="oe_menu_text">Referral Board</span></a>'
                   + '</li><li>'
                   + '<a href="/web#menu_id=148&amp;action=150" class="oe_menu_leaf" data-menu="148" data-action-model="ir.actions.act_window" data-action-id="150">'
                   + '<span class="oe_menu_text">Referral Forms</span></a></li><li>'
                   + '<a href="/web#menu_id=149&amp;action=142" class="oe_menu_leaf" data-menu="149" data-action-model="ir.actions.act_window" data-action-id="142">'
                   + '<span class="oe_menu_text">My Patients</span></a></li><li>'
                   + '<a href="/web#menu_id=150&amp;action=141" class="oe_menu_leaf" data-menu="150" data-action-model="ir.actions.act_window" data-action-id="141">'
                   + '<span class="oe_menu_text">Patient Referrals</span></a></li><li>'
                   + '<a href="/web#menu_id=151&amp;action=144" class="oe_menu_leaf" data-menu="151" data-action-model="ir.actions.act_window" data-action-id="144">'
                   + '<span class="oe_menu_text">My Patients</span></a></li><li>'
                   + '<a href="/web#menu_id=152&amp;action=143" class="oe_menu_leaf" data-menu="152" data-action-model="ir.actions.act_window" data-action-id="143">'
                   + '<span class="oe_menu_text">To be Clerked</span></a></li><li>'
                   + '<a href="/web#menu_id=153&amp;action=147" class="oe_menu_leaf" data-menu="153" data-action-model="ir.actions.act_window" data-action-id="147">'
                   + '<span class="oe_menu_text">My Patients</span></a></li><li>'
                   + '<a href="/web#menu_id=154&amp;action=145" class="oe_menu_leaf" data-menu="154" data-action-model="ir.actions.act_window" data-action-id="145">'
                   + '<span class="oe_menu_text">To be Reviewed</span></a></li><li>'
                   + '<a href="/web#menu_id=155&amp;action=149" class="oe_menu_leaf" data-menu="155" data-action-model="ir.actions.act_window" data-action-id="149">'
                   + '<span class="oe_menu_text">To be Transferred</span></a></li></ul></div>'
                   + '<div style="" class="oe_secondary_menu" data-menu-parent="156">'
                   + '<div class="oe_secondary_menu_section">Patient Management</div>'
                   + '<ul class="oe_secondary_submenu nav nav-pills nav-stacked"><li class="active">'
                   + '<a href="/web#menu_id=174&amp;action=154" class="oe_menu_leaf" data-menu="174" data-action-model="ir.actions.act_window" data-action-id="154">'
                   + '<span class="oe_menu_text">Patients Board</span></a></li><li>'
                   + '<a href="/web#menu_id=177&amp;action=155" class="oe_menu_leaf" data-menu="177" data-action-model="ir.actions.act_window" data-action-id="155">'
                   + '<span class="oe_menu_text">Patients by Ward</span></a></li><li>'
                   + '<a href="/web#menu_id=178&amp;action=156" class="oe_menu_leaf" data-menu="178" data-action-model="ir.actions.act_window" data-action-id="156">'
                   + '<span class="oe_menu_text">Recently Discharged</span></a></li><li>'
                   + '<a href="/web#menu_id=179&amp;action=157" class="oe_menu_leaf" data-menu="179" data-action-model="ir.actions.act_window" data-action-id="157">'
                   + '<span class="oe_menu_text">Recently Transferred</span></a></li><li>'
                   + '<a href="/web#menu_id=158&amp;action=161" class="oe_menu_leaf" data-menu="158" data-action-model="ir.actions.act_window" data-action-id="161">'
                   + '<span class="oe_menu_text">Patients without bed</span></a></li><li>'
                   + '<a href="/web#menu_id=180&amp;action=177" class="oe_menu_leaf" data-menu="180" data-action-model="ir.actions.act_window" data-action-id="177">'
                   + '<span class="oe_menu_text">Doctor Tasks</span></a></li><li>'
                   + '<a href="/web#menu_id=181&amp;action=166" class="oe_menu_leaf" data-menu="181" data-action-model="ir.actions.act_window" data-action-id="166">'
                   + '<span class="oe_menu_text">Overdue Tasks</span></a></li></ul>'
                   + '<div class="oe_secondary_menu_section">Ward Management</div>'
                   + '<ul class="oe_secondary_submenu nav nav-pills nav-stacked">'
                   + '<li><a href="/web#menu_id=160&amp;action=153" class="oe_menu_leaf" data-menu="160" data-action-model="ir.actions.act_window" data-action-id="153">'
                   + '<span class="oe_menu_text">Cancel Notifications</span></a></li><li>'
                   + '<a href="/web#menu_id=161&amp;action=167" class="oe_menu_leaf" data-menu="161" data-action-model="ir.actions.act_window" data-action-id="167">'
                   + '<span class="oe_menu_text">Active Points of Care</span></a></li><li>'
                   + '<a href="/web#menu_id=162&amp;action=168" class="oe_menu_leaf" data-menu="162" data-action-model="ir.actions.act_window" data-action-id="168">'
                   + '<span class="oe_menu_text">Inactive Points of Care</span></a></li><li>'
                   + '<a href="/web#menu_id=182&amp;action=159" class="oe_menu_leaf" data-menu="182" data-action-model="ir.actions.act_window" data-action-id="159">'
                   + '<span class="oe_menu_text">Activity Workload</span></a></li><li>'
                   + '<a href="/web#menu_id=164&amp;action=165" class="oe_menu_leaf" data-menu="164" data-action-model="ir.actions.act_window" data-action-id="165">'
                   + '<span class="oe_menu_text">Staff Management</span></a></li><li>'
                   + '<a href="/web#menu_id=163&amp;action=170" class="oe_menu_leaf" data-menu="163" data-action-model="ir.actions.act_window" data-action-id="170">'
                   + '<span class="oe_menu_text">Ward Dashboard</span></a></li></ul></div>'
                   + '<div style="display: none;" class="oe_secondary_menu" data-menu-parent="165">'
                   + '<div class="oe_secondary_menu_section">Data Management</div>'
                   + '<ul class="oe_secondary_submenu nav nav-pills nav-stacked">'
                   + '<li><a href="/web#menu_id=167&amp;action=172" class="oe_menu_leaf" data-menu="167" data-action-model="ir.actions.act_window" data-action-id="172">'
                   + '<span class="oe_menu_text">Manage O2 Targets</span></a></li></ul>'
                   + '<div class="oe_secondary_menu_section">Devices Management</div>'
                   + '<ul class="oe_secondary_submenu nav nav-pills nav-stacked"><li>'
                   + '<a href="/web#menu_id=169&amp;action=173" class="oe_menu_leaf" data-menu="169" data-action-model="ir.actions.act_window" data-action-id="173">'
                   + '<span class="oe_menu_text">Devices</span></a></li><li>'
                   + '<a href="/web#menu_id=170&amp;action=174" class="oe_menu_leaf" data-menu="170" data-action-model="ir.actions.act_window" data-action-id="174">'
                   + '<span class="oe_menu_text">Device Types</span></a></li><li>'
                   + '<a href="/web#menu_id=171&amp;action=175" class="oe_menu_leaf" data-menu="171" data-action-model="ir.actions.act_window" data-action-id="175">'
                   + '<span class="oe_menu_text">Device Categories</span></a></li></ul>'
                   + '<div class="oe_secondary_menu_section">User Management</div>'
                   + '<ul class="oe_secondary_submenu nav nav-pills nav-stacked"><li>'
                   + '<a href="/web#menu_id=173&amp;action=163" class="oe_menu_leaf" data-menu="173" data-action-model="ir.actions.act_window" data-action-id="163">'
                   + '<span class="oe_menu_text">Open eObs Users</span></a></li></ul></div></div></div></div>'
                   + '<div class="oe_footer">Powered by <a href="http://www.neovahealth.co.uk" target="_blank"><span>NHClinical / Odoo</span></a></div></div></div>';

function setUpFixtures(){
    $('#fixtures').html(leftbarFixture);
}

function tearDownFixtures(){
     $('#fixtures').html('');
}



describe('NH Kiosk Navigation', function() {
    var activeMenu, sectionTitles, sectionLists, navbarDiv, spyEvent;
    beforeEach(function () {
        setUpFixtures();

        activeMenu = $('.oe_secondary_menu').not(':hidden');
        sectionTitles = activeMenu.find('.oe_secondary_menu_section');
        sectionLists = activeMenu.find('.oe_secondary_submenu');
        navbarDiv = $('<div class="navbar"></div>');
        activeMenu.prepend(navbarDiv);
        sectionTitles.each(function(index){
            // set the tab id on the section header
            $(this).attr('data-tab-id', index);

            // set the tab id on the list itself
            $(this).next('ul').attr('data-tab-id', index);

            // show / hide the list based on if it is currently 'active' or not

            if($(this).next('ul').children('.active').length > 0){
                $(this).next('ul').show();
            }else{
                $(this).next('ul').hide();
            }

            // set up events to 'switch tabs'
            $(this).on('click', function(){
                var tabId = $(this).attr('data-tab-id');
               sectionLists.each(function(index){
                  if($(this).attr('data-tab-id') == tabId){
                      $(this).show();
                   }else{
                      $(this).hide();
                  }
               });
            });

            navbarDiv.append($(this));
        });

    });

    afterEach(function () {
        tearDownFixtures();
    });

    it('Sets up tab ids based on the menu sections', function () {
        expect(sectionTitles.first().attr('data-tab-id')).toBe('0');
        expect(sectionLists.first().attr('data-tab-id')).toBe('0');
        expect(sectionTitles.last().attr('data-tab-id')).toBe('1');
        expect(sectionLists.last().attr('data-tab-id')).toBe('1');
    });

    it('Shows only the active menu', function(){
        expect(sectionLists.first().css('display')).toBe('block');
        expect(sectionLists.last().css('display')).toBe('none');
    });

    it('Moves the tabs into their own div', function(){
        expect(navbarDiv.children().length).toBe(2);
        expect(activeMenu.children('.oe_secondary_menu_section').length).toBe(0);
    });

    it('Responds to clicks', function(){
        spyEvent = spyOnEvent('.navbar div[data-tab-id=0]', 'click');
        $('.navbar div[data-tab-id=0]').trigger('click');
        expect('click').toHaveBeenTriggeredOn('.navbar div[data-tab-id=0]');
        expect(spyEvent).toHaveBeenTriggered();

        spyEvent = spyOnEvent('.navbar div[data-tab-id=1]', 'click');
        $('.navbar div[data-tab-id=1]').trigger('click');
        expect('click').toHaveBeenTriggeredOn('.navbar div[data-tab-id=1]');
        expect(spyEvent).toHaveBeenTriggered();
    });

    it('Hides the first menu when the second tab is clicked', function(){
        spyEvent = spyOnEvent('.navbar div[data-tab-id=1]', 'click');
        $('.navbar [data-tab-id=1]').trigger('click');
        expect('click').toHaveBeenTriggeredOn('.navbar div[data-tab-id=1]');
        expect(spyEvent).toHaveBeenTriggered();
        expect(sectionLists.first().css('display')).toBe('none');
        expect(sectionLists.last().css('display')).toBe('block');
    });

    it('Hides the second menu when the first tab is clicked', function(){
        spyEvent = spyOnEvent('.navbar div[data-tab-id=0]', 'click');
        $('.navbar [data-tab-id=0]').trigger('click');
        expect('click').toHaveBeenTriggeredOn('.navbar div[data-tab-id=0]');
        expect(spyEvent).toHaveBeenTriggered();
        expect(sectionLists.first().css('display')).toBe('block');
        expect(sectionLists.last().css('display')).toBe('none');
    });
});